<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Extended Cartoon City Scene with Park</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
        }

        canvas {
            display: block;
            position: absolute;
            top: 0;
            left: 0;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.4);
        }

        .modal-content {
            background-color: #fefefe;
            margin: 15% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 50%;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
    </style>
</head>

<body>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/build/three.min.js"></script>
    <script src="https://cdn.rawgit.com/mrdoob/three.js/r128/examples/js/controls/OrbitControls.js"></script>

    <script>
        let scene, camera, renderer, raycaster = new THREE.Raycaster(), mouse = new THREE.Vector2(), clickableObjects = [];

        init();
        animate();

        function init() {
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(55, window.innerWidth / window.innerHeight, 1, 20000);
            camera.position.set(200, 80, 200);
            camera.lookAt(0, 15, 0);

            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);

            new THREE.OrbitControls(camera, renderer.domElement);

            const ambientLight = new THREE.AmbientLight(0xffffff, 0.4);
            scene.add(ambientLight);

            const sunLight = new THREE.DirectionalLight(0xffffff, 0.8);
            sunLight.position.set(50, 100, 50);
            scene.add(sunLight);

            const textureLoader = new THREE.TextureLoader();
            const grassTexture = textureLoader.load('static/images/grass.jpg'); // Replace with your grass texture path
            const mansionTexture = textureLoader.load('static/images/mansion.png');

            createGround(grassTexture);
            createCity();
            createPark();
            createMansions(mansionTexture);
            addQuestionMarks();

            renderer.domElement.addEventListener('click', onClick, false);
            window.addEventListener('resize', onWindowResize, false);
        }

        function createGround(texture) {
            const groundGeometry = new THREE.PlaneGeometry(100, 100);  // Adjusted size
            const groundMaterial = new THREE.MeshLambertMaterial({ map: texture });
            const ground = new THREE.Mesh(groundGeometry, groundMaterial);
            ground.rotation.x = -Math.PI / 2;
            scene.add(ground);
        }

        function createCity() {
            const buildingMaterial = new THREE.MeshLambertMaterial({ color: 0x888888 });
            const windowMaterial = new THREE.MeshLambertMaterial({ color: 0xccddff });

            for (let i = -40; i <= -10; i += 5) {
                for (let j = -10; j <= 10; j += 5) {
                    const height = Math.random() * 30 + 10;
                    const building = new THREE.Mesh(new THREE.BoxGeometry(4, height, 4), buildingMaterial);
                    building.position.set(i, height / 2 - 10, j);
                    scene.add(building);

                    const windowGeometry = new THREE.BoxGeometry(1, 1, 0.05);
                    for (let w = -1; w <= 1; w += 2) {
                        for (let h = 5; h < height; h += 3) {
                            const windowMesh = new THREE.Mesh(windowGeometry, windowMaterial);
                            windowMesh.position.set(i + w, h - 10, j + 2);
                            scene.add(windowMesh);

                            const windowMeshOpposite = windowMesh.clone();
                            windowMeshOpposite.position.z = j - 2;
                            scene.add(windowMeshOpposite);
                        }
                    }
                }
            }
        }

        function createPark() {
            const treeColors = [0x228B22, 0x32CD32, 0x008000];
            const trunkMaterial = new THREE.MeshLambertMaterial({ color: 0x8B4513 });
            const benchMaterial = new THREE.MeshLambertMaterial({ color: 0x654321 });

            for (let i = -35; i <= 60; i += Math.random() * 5 + 5) {
                for (let j = 15 + Math.random() * 5; j <= 35; j += Math.random() * 5 + 5) {
                    const trunkPos = new THREE.Vector3(i + (Math.random() * 10 - 5), -5, j + (Math.random() * 10 - 5));

                    const trunk = new THREE.Mesh(new THREE.CylinderGeometry(0.5, 0.5, 5), trunkMaterial);
                    trunk.position.copy(trunkPos);
                    scene.add(trunk);

                    const leaves = new THREE.Mesh(new THREE.SphereGeometry(4), new THREE.MeshLambertMaterial({ color: treeColors[Math.floor(Math.random() * treeColors.length)] }));
                    leaves.position.set(trunkPos.x, trunkPos.y + 6, trunkPos.z);
                    scene.add(leaves);
                }
            }

            for (let i = -20; i <= 50; i += 35) {
                for (let j = 20; j <= 30; j += 10) {
                    const benchBase = new THREE.Mesh(new THREE.BoxGeometry(10, 0.5, 2), benchMaterial);
                    benchBase.position.set(i, -9.75, j);
                    scene.add(benchBase);

                    const benchBack = new THREE.Mesh(new THREE.BoxGeometry(10, 2, 0.5), benchMaterial);
                    benchBack.position.set(i, -8.75, j + 1);
                    scene.add(benchBack);
                }
            }
        }

        function createMansions(mansionTexture) {
            const mansionMaterial = new THREE.MeshLambertMaterial({ map: mansionTexture });
            const windowMaterial = new THREE.MeshLambertMaterial({ color: 0xddddff });

            const mansionPositions = [{ x: 10, z: -15 }, { x: 10, z: 15 }];

            mansionPositions.forEach(pos => {
                const depth = Math.random() * 20 + 20;
                const width = Math.random() * 20 + 20;
                const height = Math.random() * 15 + 15;
                const mansion = new THREE.Mesh(new THREE.BoxGeometry(width, height, depth), mansionMaterial);
                mansion.position.set(pos.x, height / 2 - 10, pos.z);
                scene.add(mansion);

                const windowGeometry = new THREE.BoxGeometry(3, 3, 0.1);
                for (let w = -width / 2 + 4; w <= width / 2 - 4; w += 8) {
                    for (let h = 5; h < height; h += 6) {
                        const windowMesh = new THREE.Mesh(windowGeometry, windowMaterial);
                        windowMesh.position.set(pos.x + w, h - 10, pos.z + depth / 2 - 0.5);
                        scene.add(windowMesh);

                        const windowMeshOpposite = windowMesh.clone();
                        windowMeshOpposite.position.z = pos.z - depth / 2 + 0.5;
                        scene.add(windowMeshOpposite);
                    }
                }
            });
        }

        function addQuestionMarks() {
            new THREE.FontLoader().load('https://threejs.org/examples/fonts/helvetiker_regular.typeface.json', function (font) {
                const textGeometry = new THREE.TextGeometry('?', { font: font, size: 10, height: 2, curveSegments: 12, bevelEnabled: true, bevelThickness: 0.5, bevelSize: 0.25, bevelSegments: 5 });
                const materials = [new THREE.MeshPhongMaterial({ color: 0xff0000 }), new THREE.MeshPhongMaterial({ color: 0x00ff00 }), new THREE.MeshPhongMaterial({ color: 0x0000ff }), new THREE.MeshPhongMaterial({ color: 0xffff00 })];

                materials.forEach((material, i) => {
                    const textMesh = new THREE.Mesh(textGeometry, material);
                    textMesh.position.set(-40 + i * 15, 20, 30);
                    scene.add(textMesh);
                    clickableObjects.push(textMesh);
                });
            });
        }

        function animate() {
            requestAnimationFrame(animate);
            renderer.render(scene, camera);
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        function onClick(event) {
            event.preventDefault();
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;

            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObjects(clickableObjects);

            if (intersects.length > 0) openModal(`modal${clickableObjects.indexOf(intersects[0].object) + 1}`);
        }

        function openModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.style.display = "block";
            modal.addEventListener('click', (event) => {
                if (event.target.className === "close" || event.target === modal) modal.style.display = "none";
            });
        }
    </script>

    <div id="modal1" class="modal"><div class="modal-content"><span class="close">&times;</span><h2>Title 1</h2><p>Description for question mark 1</p></div></div>
    <div id="modal2" class="modal"><div class="modal-content"><span class="close">&times;</span><h2>Title 2</h2><p>Description for question mark 2</p></div></div>
    <div id="modal3" class="modal"><div class="modal-content"><span class="close">&times;</span><h2>Title 3</h2><p>Description for question mark 3</p></div></div>
    <div id="modal4" class="modal"><div class="modal-content"><span class="close">&times;</span><h2>Title 4</h2><p>Description for question mark 4</p></div></div>

</body>
</html>
